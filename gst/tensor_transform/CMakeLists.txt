SET(TRANSFORM_SRCS
	tensor_transform.c
)

IF(DEFINED HAVE_ORC AND HAVE_ORC)
	SET(ORC_SOURCE transform-orc)
	SET(ORC_OUT_PREFIX ${CMAKE_CURRENT_SOURCE_DIR}/${ORC_SOURCE})

	# Generate orc .h and .c files
	ADD_CUSTOM_COMMAND(
		OUTPUT ${ORC_OUT_PREFIX}.h ${ORC_OUT_PREFIX}.c
		COMMAND rm -f ${ORC_OUT_PREFIX}.h
		COMMAND rm -f ${ORC_OUT_PREFIX}.c
		COMMAND orcc --implementation --include glib.h -o ${ORC_OUT_PREFIX}.c ${ORC_OUT_PREFIX}.orc
		COMMAND orcc --header --include glib.h -o ${ORC_OUT_PREFIX}.h ${ORC_OUT_PREFIX}.orc
		DEPENDS ${ORC_OUT_PREFIX}.orc
	)

	SET(TRANSFORM_SRCS ${TRANSFORM_SRCS} ${ORC_SOURCE}.c)
ENDIF(DEFINED HAVE_ORC AND HAVE_ORC)

ADD_LIBRARY(tensor_transformOBJ OBJECT ${TRANSFORM_SRCS})

IF(DEFINED HAVE_ORC AND HAVE_ORC)
	# Add dependency
	ADD_CUSTOM_TARGET(
		generated-orc
		DEPENDS ${ORC_SOURCE}.h ${ORC_SOURCE}.c
	)

	ADD_DEPENDENCIES(tensor_transformOBJ generated-orc)
ENDIF(DEFINED HAVE_ORC AND HAVE_ORC)
